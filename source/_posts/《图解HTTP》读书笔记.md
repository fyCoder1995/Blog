---
title: 图解HTTP(未完成)
tags: 技术类书籍
categories: 读书笔记
excerpt: 《图解HTTP》摘录归纳
date: 2023-03-06 15:55:26
---

## 一、了解Web及网络基础

#### 什么是HTTP协议？

```
HTTP (HyperText Transfer Protocol) 超文本传输协议
```

从客户端到服务端请求一系列运作流程的规范约定

**诞生**

*1989年3月CERN（欧洲核物理研究所）蒂姆·伯纳斯-李博士 提出一种能让远隔两地的研究者共享知识的设想*

*构建技术：*

1. 把SGML作为页面的文本标记语言的HTML

   *SGML（Standard Generalized Markup Language 标准通用标记语言）*

   *HTML （HyperText Markup Language 超文本标记语言）*

2. 作为文档传递协议的**HTTP**

3. 指定文档所在地址的URL（Uniform Resource Locator 统一资源定位符）

###### **成长**

- web（野蛮生长）

*1990年11月 CERN成功研发了世界上第一台Web服务器和Web浏览器*

*1993年1月 NCSA（National Center for Supercomputer Applications 美国国家超级计算机应用中心）研发的Mosaic问世，它以内联（in-line）等形式显示HTML图像 童年秋天Mosaic的Windows版和Macintosh版面世*

*1994年12月 网景通信公司发布了Netscape Navigator 1.0*

*1995年微软公司发布Internet Explorer 1.0和2.0*

*1995年左右起，微软公司与网景通信公司之间爆发浏览器大战*

*2000年前后，这场浏览器战争随着网景通信公司的衰落而暂告以段落*

*2004年 Mozilla基金会发布了Firefox浏览器，第二次浏览器大战随机爆发*

*之后 Internet Explorer 浏览器的版本从6升到了7 前后花费了5年时间....再后来Chrome、Opera、safari等纷纷抢占市场份额*

- HTTP（驻足不前）

  *1990年问世 HTTP/0.9*

  *1996年5月 正式作为标准被公布 版本命名为HTTP/1.0 并记载于RFC1945*

  *1997年1月公布的HTTP/1.1 是目前主流的HTTP协议版本 RFC2068*

  *修订版 RFC2626*

  *新一代HTTP/2.0 正在修订中，但要达到较高的使用覆盖率，仍需假以时日*

  

#### 什么是TCP/IP协议族？

```
通常使用的网络（包括互联网）是在TCP/IP协议族的基础上运作的。而HTTP属于它内部的一个子集。
把与互联网相关联的协议集合起来的总称
```

*该篇仅介绍理解HTTP所需掌握的TCP/IP协议族的概要*

**分层管理**

1. 应用层（决定了向用户提供应用服务时通信的活动）

   应用服务：FTP（File Transfer Protocol 文件传输协议）、DNS（Domain Name System 域名系统）服务

   **HTTP协议处于该层**

   ```
   HTTP报文+HTTP数据
   ```

2. 传输层（对上层应用层，提供处于网络连接中的两台计算机之间的数据传输）

   TCP（Transmission Control Protocol 传输控制协议）——可靠

   UDP（User Data Protocol 用户数据协议）——不可靠

   ```
   TCP报文段+TCP首部
   ```

3. 网络层【网络互连层】（用来处理在网络上流动的数据包）

   ```
   IP数据包+IP首部
   ```

4. 数据链路层【链路层、网络接口层】（用来处理连接网络的硬件部分）

   ```
   网络架构+以太网首部
   ```



#### 与HTTP关系密切的协议：IP、TCP和DNS

**IP协议（负责传输，位于应用层）**

```
重要条件：
1、IP地址:节点被分配到的地址——可变换
2、MAC地址(Media Address Control Address):网卡所属的固定地址——基本不改
```

*ARP协议（Address Resolution Protocol）：一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址*

**TCP协议（提供可靠的字节流服务，位于传输层）**

```
三次握手（three-way handshaking）策略
SYN（synchronize-同步）
ACK（acknowledgement-确认）
```

![image-20221020170828489](/Users/shenyihuan/Library/Application Support/typora-user-images/image-20221020170828489.png)

**DNS服务（负责域名解析，位于应用层）**

```
提供通过域名查找IP地址，或逆向从IP地址反查域名
```

#### 在浏览器中输入URL后都会发生什么？

1. 用户输入URL

2. 回车，浏览器进程将url传给网络进程

3. 网络进程接收到url，先查找有没有缓存，没有缓存，进入网络请求。首先获取域名IP，系统从hosts文件中寻找与域名对应的IP地址。找到，与服务器建立TCP连接。没有找到，将网址提交DNS域名解析服务器进行IP地址解析

4. 使用IP地址和服务器建立TCP连接【三次握手】

5. 建立连接后，浏览器构建数据包，向服务器发送请求消息

6. 服务器接收到消息后根据请求信息构建响应数据，发送回网络进程

7. 网络进程接收到响应数据后进行解析，如果状态码返回了200，说明服务器返回了数据

8. 数据传输完成，TCP四次挥手断开连接

9. 网络进程将获取到的数据包进行解析，根据响应头类型判断，如果是字节流类型，就交给下载管理器，如果是text/html类型 就通知浏览器进程获取到文档准备渲染

10. 渲染进程对文档进行页面解析和子资源加载。解析html生成DOM树，解析css生成规则树。两树结合生成渲染树，浏览器绘制各个节点，将页面展现给用户

    

##  二、简单的HTTP协议

#### URI与URL的关系

URI（Uniform Resource Identifier 统一资源表示符）

**用字符串标识某一互联网资源**

URL（Uniform Resource Locator 统一资源定位符）

**资源的位置**

```
URL是URI的子集
```

#### 请求和响应

**请求必定由客户端发出，而服务器端回复响应**

*请求报文：*

1. 请求方法
2. 请求URI
3. 协议版本
4. 可选的请求首部字段
5. 内容实体

*响应报文*

1. 协议版本
2. 状态码
3. 用以解释状态码的原因短语
4. 可选的响应首部字段
5. 实体主体

#### cookie技术（通过请求和响应报文中写入Cookie信息来控制客户端的状态）

**HTTP是一种不保存状态吗，即无状态(stateless)协议**

好处：不保存状态，可以减少服务器的cpu及内存资源的消耗

[Cookie与session的区别](https://blog.csdn.net/m0_64224975/article/details/124934388)

#### HTTP方法

1. GET 获取资源

   用来请求访问已被URI识别的资源

2. POST 传输实体主体

   用来传输实体的主体，虽然用get也可以传输实体的主体，但一般不用get方法进行传输。

   [POST与GET区别详解](https://blog.csdn.net/qq_42931285/article/details/119852294)

3. PUT 传输文件

   HTTP/1.1的put方法自身不带验证机制，任何人都可以上传文件，存在安全性问题，因此一般不使用。

4. HEAD 获得报文首部

   用于确认URI的有效性及资源更新的日期时间等

5. DELETE 删除文件

   按请求URI删除指定的资源

6. OPTIONS 询问支持的方法

   用来查询针对请求URI指定的资源支持的方法

7. TRACT 追踪路径

   让web服务器端将之前的请求通信返回给客户端

   （发送请求是，在Max-forwards首部字段中填入数值，每经过一个服务器就将该数值减1，当数值刚好减到0时，就停止传输。不常用，并且容易引发XST【cross-site Tracing 跨站追踪】攻击）

8. CONNECT 要求用隧道协议连接代理 

   要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL（Secure Sockets Layer安全套接层）和 TLS（Transport layer Security 传输层安全）协议把通信内容加密后经网络隧道传输

9. LINK 建立和资源之间的联系

10. UNLINK 断开连接关系



HTTP协议的初始版本中，每进行一次HTTP通信就要断开一次TCP连接

#### 如何节省通信开销？

**持久连接（HTTP keep-alive、HTTP connection reuse）**

特点：只要任意一段没有明确提出断开连接，则保持TCP连接状态

好处：减少TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

**在HTTP1.1中，所有的连接默认都是持久连接。**

**管线化（pipelining）**

可以做到同时并行发送请求，而不需要一个接一个地等待响应。管线化比持久连接还要快。请求数越多，时间差就越明显。

## 三、HTTP报文内的HTTP信息

#### HTTP报文

1. 报文首部 - 服务端或者客户端需要处理的请求或响应的内容及属性

   > 请求报文

   - 请求行 - 包含用于请求的方法，请求URI和HTTP版本
   - 请求首部字段
   - 通用首部字段
   - 实体首部字段
   - 其他

   > 响应报文

   - 状态行 - 包含表明响应结果的状态码，原因短语和HTTP版本
   - 响应首部字段
   - 通用首部字段
   - 实体首部字段
   - 其他

2. 报文主体 - 应被发送的内容

#### 编码提升传输速率

> 内容编码

指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

*常用的内容编码*

- gzip（GNU zip）
- compress （UNIX系统的标准压缩）
- deflate （zlib）
- identiy（不进行编码）

> 分块传输编码（Chunked Transfer Coding）

将实体主体分成多个部分（块）。每一块都会用十六进制来标记块的大小。由接收的客户端负责解码，恢复到编码前的实体主体

#### 发送多种数据的多部分对象集合

**MIME（Multporpose Internet Mail Extensions 多用途因特网邮件）机制**

> 为了容纳多份不同类型的数据，HTTP协议中采纳了 多部份对象集合（multipart）

- multipart/form-data *在web表单文件上传时使用*
- multipart/byteranges *状态码206响应报文包含了多个范围内容时使用*（content-range）【断线重联/范围请求】

**在HTTP报文中使用多部分对象集合时，需要在首部字段里加上Content-type**

#### 内容协商

客户端和服务端就响应的资源进行交涉，然后提供给客户端最为合适的资源【语言、字符集、编码方式】

*eg: 当浏览器的默认语言为英语或中文，访问相同URI的Web页面时，则会显示对应的英语版或中文版的web页面*

1. 服务器驱动协商 - 由服务端进行内容协商
2. 客户端驱动协商 - 由客户端进行内容协商
3. 透明协商 - 由服务器端和客户端各自进行内容协商

## 四、返回结果的HTTP状态码

当客户端向服务器端发送请求时，描述返回的请求结果

*数字第一位指定了响应类别*

##### 1XX Informational（信息性状态码）

【接收的请求正在处理】

##### 2XX Success（成功状态码）

【请求正常处理完毕】

- 200 Ok - 请求已正常处理

- 204 No Content - 请求处理成功，但没有资源可返回

  *eg：在只需要从客户端往服务端发送信息，而对客户端不需要发送新信息内容的情况下时使用*

- 206 Partial Content - 对资源某一部分的请求，表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由Content-Range指定范围的实体内容

##### 3XX Redirection（重定向状态码）

【需要进行附加操作以完成请求】

- 301 Moved Permanently - 永久性重定向，表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI
- 302 Found - 临时性重定向，表示请求的资源已被分配了新的URI，希望用户（本次）能使用新的URI访问
- 303 See Other - 表示请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源，与302有相同的功能
- 304 - Not Modified - 和重定向没关系的状态码，表示客户端发送请求，服务端允许请求访问资源，但因发生请求未满足的条件后，直接返回304
- 307 Temporary Redirect - 临时重定向 与302类似，但会遵照浏览器标准，不会从POST变成GET

*当301、302、303响应状态码返回时，几乎所有的浏览器都会把POST改成GET，并删除请求报文内的主体，之后请求会自动再次发送*

##### 4XX Client Error（客户端错误状态码）

【服务器无法处理请求，表明客户端是发生错误的原因所在】

- 400 Bad Request - 表示请求报文中存在语法错误

- 401 Unauthorized - 表示发送的请求需要通过HTTP认证（BASIC认证、DIGEST认证）的认证信息。另：若之前已进行过1次请求，则表示用户认证失败

- 403 Forbidden -表示对请求资源的访问被服务器拒绝了。

  *eg：未获得文件系统的访问权限，访问权限出现某些问题*

- 404 Not Found - 服务器上没有请求的资源，或者服务器端拒绝请求且不想说明理由

##### 5XX Server Error（服务器错误状态码）

【服务器处理请求出错】

- 500 Internal Server Error - 表明服务器端在执行请求时发生了错误。也有可能时web应用存在的bug或某些临时的故障
- 503 Service Unavailable -表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求

```
仅记录在RFC2616上的HTTP状态码就有40种，加上webDAV（基于万维网的分布式创作和版本控制）和RFC6585等扩展，数量就达60余种
```



## 五、与HTTP协作的Web服务器

```
一台web服务器可搭建多个独立域名的web网站，也可作为通信路径上的中转服务器提升传输效率
```

##### 单台虚拟主机实现多个域名

> 在相同的IP地址下，由于虚拟主机可以寄存多个不同主机名和域名的web网站，因此在发送HTTP请求时，必须在Host首部内完成指定主机名或域名的URI

##### 通信数据转发程序

- 代理 

  服务器和客户端之间的“中间人”角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端

- 网关

  转发其他服务器通信数据的服务器

- 隧道

  在相隔甚远的客户端和服务器两者之间进行中转，并保持通信连接的应用程序

##### 缓存

代理服务器或客户端本地磁盘内保存的资源副本。

好处：减少为源服务器的访问，节省了通信流量和通信时间。

```
在HTTP之前出现的协议
 。FTP //传输文件时使用的协议
 。NNTP //用于NetNews电子会议室内传送消息的协议，淘汰
 。Archie //搜索anonymousFTP公开的文件信息的协议，淘汰
 。WAIS //以关键词检索多个数据库使用的协议，淘汰
 。Gopher //查找与互联网连接的计算机内信息的协议，淘汰
```



## 六、HTTP首部（第三章扩展）



## 七、确保Web安全的HTTPS

 

## 八、确认访问用户身份的认证



## 九、基于HTTP的功能追加协议



## 十、构建Web内容的技术



## 十一、Web的攻击技术

